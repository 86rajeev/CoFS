/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
 * async
 * https://github.com/caolan/async
 *
 * Copyright 2010-2014 Caolan McMahon
 * Released under the MIT license
 */

/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */

!function(t,e){if("function"==typeof define&&define.amd)define([],e);else{var n=t.CoFS;t.CoFS=e(),t.CoFS.noConflict=function(){return t.CoFS=n,CoFS}}}(this,function(){var t,e,n;return function(r){function i(t,e){return _.call(t,e)}function o(t,e){var n,r,i,o,s,u,a,f,l,c,h,p=e&&e.split("/"),d=m.map,y=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),t=t.split("/"),s=t.length-1,m.nodeIdCompat&&E.test(t[s])&&(t[s]=t[s].replace(E,"")),t=p.concat(t),l=0;l<t.length;l+=1)if(h=t[l],"."===h)t.splice(l,1),l-=1;else if(".."===h){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||y)&&d){for(n=t.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),p)for(c=p.length;c>0;c-=1)if(i=d[p.slice(0,c).join("/")],i&&(i=i[r])){o=i,u=l;break}if(o)break;!a&&y&&y[r]&&(a=y[r],f=l)}!o&&a&&(o=a,u=f),o&&(n.splice(0,u,o),t=n.join("/"))}return t}function s(t,e){return function(){var n=b.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),p.apply(r,n.concat([t,e]))}}function u(t){return function(e){return o(e,t)}}function a(t){return function(e){g[t]=e}}function f(t){if(i(v,t)){var e=v[t];delete v[t],w[t]=!0,h.apply(r,e)}if(!i(g,t)&&!i(w,t))throw new Error("No "+t);return g[t]}function l(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function c(t){return function(){return m&&m.config&&m.config[t]||{}}}var h,p,d,y,g={},v={},m={},w={},_=Object.prototype.hasOwnProperty,b=[].slice,E=/\.js$/;d=function(t,e){var n,r=l(t),i=r[0];return t=r[1],i&&(i=o(i,e),n=f(i)),i?t=n&&n.normalize?n.normalize(t,u(e)):o(t,e):(t=o(t,e),r=l(t),i=r[0],t=r[1],i&&(n=f(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:n}},y={require:function(t){return s(t)},exports:function(t){var e=g[t];return"undefined"!=typeof e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:c(t)}}},h=function(t,e,n,o){var u,l,c,h,p,m,_=[],b=typeof n;if(o=o||t,"undefined"===b||"function"===b){for(e=!e.length&&n.length?["require","exports","module"]:e,p=0;p<e.length;p+=1)if(h=d(e[p],o),l=h.f,"require"===l)_[p]=y.require(t);else if("exports"===l)_[p]=y.exports(t),m=!0;else if("module"===l)u=_[p]=y.module(t);else if(i(g,l)||i(v,l)||i(w,l))_[p]=f(l);else{if(!h.p)throw new Error(t+" missing "+l);h.p.load(h.n,s(o,!0),a(l),{}),_[p]=g[l]}c=n?n.apply(g[t],_):void 0,t&&(u&&u.exports!==r&&u.exports!==g[t]?g[t]=u.exports:c===r&&m||(g[t]=c))}else t&&(g[t]=n)},t=e=p=function(t,e,n,i,o){if("string"==typeof t)return y[t]?y[t](e):f(d(t,e).f);if(!t.splice){if(m=t,m.deps&&p(m.deps,m.callback),!e)return;e.splice?(t=e,e=n,n=null):t=r}return e=e||function(){},"function"==typeof n&&(n=i,i=o),i?h(r,t,e,n):setTimeout(function(){h(r,t,e,n)},4),p},p.config=function(t){return p(t)},t._defined=g,n=function(t,e,n){e.splice||(n=e,e=[]),i(g,t)||i(v,t)||(v[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("node_modules/almond/almond",function(){}),function(){function t(t){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,t.apply(e,arguments)}}var e,r,i={};e=this,null!=e&&(r=e.async),i.noConflict=function(){return e.async=r,i};var o=Object.prototype.toString,s=Array.isArray||function(t){return"[object Array]"===o.call(t)},u=function(t,e){for(var n=0;n<t.length;n+=1)e(t[n],n,t)},a=function(t,e){if(t.map)return t.map(e);var n=[];return u(t,function(t,r,i){n.push(e(t,r,i))}),n},f=function(t,e,n){return t.reduce?t.reduce(e,n):(u(t,function(t,r,i){n=e(n,t,r,i)}),n)},l=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e};"undefined"!=typeof process&&process.nextTick?(i.nextTick=process.nextTick,i.setImmediate="undefined"!=typeof setImmediate?function(t){setImmediate(t)}:i.nextTick):"function"==typeof setImmediate?(i.nextTick=function(t){setImmediate(t)},i.setImmediate=i.nextTick):(i.nextTick=function(t){setTimeout(t,0)},i.setImmediate=i.nextTick),i.each=function(e,n,r){function i(t){t?(r(t),r=function(){}):(o+=1,o>=e.length&&r())}if(r=r||function(){},!e.length)return r();var o=0;u(e,function(e){n(e,t(i))})},i.forEach=i.each,i.eachSeries=function(t,e,n){if(n=n||function(){},!t.length)return n();var r=0,i=function(){e(t[r],function(e){e?(n(e),n=function(){}):(r+=1,r>=t.length?n():i())})};i()},i.forEachSeries=i.eachSeries,i.eachLimit=function(t,e,n,r){var i=c(e);i.apply(null,[t,n,r])},i.forEachLimit=i.eachLimit;var c=function(t){return function(e,n,r){if(r=r||function(){},!e.length||0>=t)return r();var i=0,o=0,s=0;!function u(){if(i>=e.length)return r();for(;t>s&&o<e.length;)o+=1,s+=1,n(e[o-1],function(t){t?(r(t),r=function(){}):(i+=1,s-=1,i>=e.length?r():u())})}()}},h=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[i.each].concat(e))}},p=function(t,e){return function(){var n=Array.prototype.slice.call(arguments);return e.apply(null,[c(t)].concat(n))}},d=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[i.eachSeries].concat(e))}},y=function(t,e,n,r){if(e=a(e,function(t,e){return{index:e,value:t}}),r){var i=[];t(e,function(t,e){n(t.value,function(n,r){i[t.index]=r,e(n)})},function(t){r(t,i)})}else t(e,function(t,e){n(t.value,function(t){e(t)})})};i.map=h(y),i.mapSeries=d(y),i.mapLimit=function(t,e,n,r){return g(e)(t,n,r)};var g=function(t){return p(t,y)};i.reduce=function(t,e,n,r){i.eachSeries(t,function(t,r){n(e,t,function(t,n){e=n,r(t)})},function(t){r(t,e)})},i.inject=i.reduce,i.foldl=i.reduce,i.reduceRight=function(t,e,n,r){var o=a(t,function(t){return t}).reverse();i.reduce(o,e,n,r)},i.foldr=i.reduceRight;var v=function(t,e,n,r){var i=[];e=a(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n){n&&i.push(t),e()})},function(){r(a(i.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};i.filter=h(v),i.filterSeries=d(v),i.select=i.filter,i.selectSeries=i.filterSeries;var m=function(t,e,n,r){var i=[];e=a(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n){n||i.push(t),e()})},function(){r(a(i.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};i.reject=h(m),i.rejectSeries=d(m);var w=function(t,e,n,r){t(e,function(t,e){n(t,function(n){n?(r(t),r=function(){}):e()})},function(){r()})};i.detect=h(w),i.detectSeries=d(w),i.some=function(t,e,n){i.each(t,function(t,r){e(t,function(t){t&&(n(!0),n=function(){}),r()})},function(){n(!1)})},i.any=i.some,i.every=function(t,e,n){i.each(t,function(t,r){e(t,function(t){t||(n(!1),n=function(){}),r()})},function(){n(!0)})},i.all=i.every,i.sortBy=function(t,e,n){i.map(t,function(t,n){e(t,function(e,r){e?n(e):n(null,{value:t,criteria:r})})},function(t,e){if(t)return n(t);var r=function(t,e){var n=t.criteria,r=e.criteria;return r>n?-1:n>r?1:0};n(null,a(e.sort(r),function(t){return t.value}))})},i.auto=function(t,e){e=e||function(){};var n=l(t),r=n.length;if(!r)return e();var o={},a=[],c=function(t){a.unshift(t)},h=function(t){for(var e=0;e<a.length;e+=1)if(a[e]===t)return void a.splice(e,1)},p=function(){r--,u(a.slice(0),function(t){t()})};c(function(){if(!r){var t=e;e=function(){},t(null,o)}}),u(n,function(n){var r=s(t[n])?t[n]:[t[n]],a=function(t){var r=Array.prototype.slice.call(arguments,1);if(r.length<=1&&(r=r[0]),t){var s={};u(l(o),function(t){s[t]=o[t]}),s[n]=r,e(t,s),e=function(){}}else o[n]=r,i.setImmediate(p)},d=r.slice(0,Math.abs(r.length-1))||[],y=function(){return f(d,function(t,e){return t&&o.hasOwnProperty(e)},!0)&&!o.hasOwnProperty(n)};if(y())r[r.length-1](a,o);else{var g=function(){y()&&(h(g),r[r.length-1](a,o))};c(g)}})},i.retry=function(t,e,n){var r=5,o=[];"function"==typeof t&&(n=e,e=t,t=r),t=parseInt(t,10)||r;var s=function(r,s){for(var u=function(t,e){return function(n){t(function(t,r){n(!t||e,{err:t,result:r})},s)}};t;)o.push(u(e,!(t-=1)));i.series(o,function(t,e){e=e[e.length-1],(r||n)(e.err,e.result)})};return n?s():s},i.waterfall=function(t,e){if(e=e||function(){},!s(t)){var n=new Error("First argument to waterfall must be an array of functions");return e(n)}if(!t.length)return e();var r=function(t){return function(n){if(n)e.apply(null,arguments),e=function(){};else{var o=Array.prototype.slice.call(arguments,1),s=t.next();o.push(s?r(s):e),i.setImmediate(function(){t.apply(null,o)})}}};r(i.iterator(t))()};var _=function(t,e,n){if(n=n||function(){},s(e))t.map(e,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},n);else{var r={};t.each(l(e),function(t,n){e[t](function(e){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[t]=i,n(e)})},function(t){n(t,r)})}};i.parallel=function(t,e){_({map:i.map,each:i.each},t,e)},i.parallelLimit=function(t,e,n){_({map:g(e),each:c(e)},t,n)},i.series=function(t,e){if(e=e||function(){},s(t))i.mapSeries(t,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},e);else{var n={};i.eachSeries(l(t),function(e,r){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),n[e]=i,r(t)})},function(t){e(t,n)})}},i.iterator=function(t){var e=function(n){var r=function(){return t.length&&t[n].apply(null,arguments),r.next()};return r.next=function(){return n<t.length-1?e(n+1):null},r};return e(0)},i.apply=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e.concat(Array.prototype.slice.call(arguments)))}};var b=function(t,e,n,r){var i=[];t(e,function(t,e){n(t,function(t,n){i=i.concat(n||[]),e(t)})},function(t){r(t,i)})};i.concat=h(b),i.concatSeries=d(b),i.whilst=function(t,e,n){t()?e(function(r){return r?n(r):void i.whilst(t,e,n)}):n()},i.doWhilst=function(t,e,n){t(function(r){if(r)return n(r);var o=Array.prototype.slice.call(arguments,1);e.apply(null,o)?i.doWhilst(t,e,n):n()})},i.until=function(t,e,n){t()?n():e(function(r){return r?n(r):void i.until(t,e,n)})},i.doUntil=function(t,e,n){t(function(r){if(r)return n(r);var o=Array.prototype.slice.call(arguments,1);e.apply(null,o)?n():i.doUntil(t,e,n)})},i.queue=function(e,n){function r(t,e,n,r){return t.started||(t.started=!0),s(e)||(e=[e]),0==e.length?i.setImmediate(function(){t.drain&&t.drain()}):void u(e,function(e){var o={data:e,callback:"function"==typeof r?r:null};n?t.tasks.unshift(o):t.tasks.push(o),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),i.setImmediate(t.process)})}void 0===n&&(n=1);var o=0,a={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(t,e){r(a,t,!1,e)},kill:function(){a.drain=null,a.tasks=[]},unshift:function(t,e){r(a,t,!0,e)},process:function(){if(!a.paused&&o<a.concurrency&&a.tasks.length){var n=a.tasks.shift();a.empty&&0===a.tasks.length&&a.empty(),o+=1;var r=function(){o-=1,n.callback&&n.callback.apply(n,arguments),a.drain&&a.tasks.length+o===0&&a.drain(),a.process()},i=t(r);e(n.data,i)}},length:function(){return a.tasks.length},running:function(){return o},idle:function(){return a.tasks.length+o===0},pause:function(){a.paused!==!0&&(a.paused=!0)},resume:function(){if(a.paused!==!1){a.paused=!1;for(var t=1;t<=a.concurrency;t++)i.setImmediate(a.process)}}};return a},i.priorityQueue=function(t,e){function n(t,e){return t.priority-e.priority}function r(t,e,n){for(var r=-1,i=t.length-1;i>r;){var o=r+(i-r+1>>>1);n(e,t[o])>=0?r=o:i=o-1}return r}function o(t,e,o,a){return t.started||(t.started=!0),s(e)||(e=[e]),0==e.length?i.setImmediate(function(){t.drain&&t.drain()}):void u(e,function(e){var s={data:e,priority:o,callback:"function"==typeof a?a:null};t.tasks.splice(r(t.tasks,s,n)+1,0,s),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),i.setImmediate(t.process)})}var a=i.queue(t,e);return a.push=function(t,e,n){o(a,t,e,n)},delete a.unshift,a},i.cargo=function(t,e){var n=!1,r=[],o={tasks:r,payload:e,saturated:null,empty:null,drain:null,drained:!0,push:function(t,n){s(t)||(t=[t]),u(t,function(t){r.push({data:t,callback:"function"==typeof n?n:null}),o.drained=!1,o.saturated&&r.length===e&&o.saturated()}),i.setImmediate(o.process)},process:function f(){if(!n){if(0===r.length)return o.drain&&!o.drained&&o.drain(),void(o.drained=!0);var i="number"==typeof e?r.splice(0,e):r.splice(0,r.length),s=a(i,function(t){return t.data});o.empty&&o.empty(),n=!0,t(s,function(){n=!1;var t=arguments;u(i,function(e){e.callback&&e.callback.apply(null,t)}),f()})}},length:function(){return r.length},running:function(){return n}};return o};var E=function(t){return function(e){var n=Array.prototype.slice.call(arguments,1);e.apply(null,n.concat([function(e){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[t]&&u(n,function(e){console[t](e)}))}]))}};i.log=E("log"),i.dir=E("dir"),i.memoize=function(t,e){var n={},r={};e=e||function(t){return t};var o=function(){var o=Array.prototype.slice.call(arguments),s=o.pop(),u=e.apply(null,o);u in n?i.nextTick(function(){s.apply(null,n[u])}):u in r?r[u].push(s):(r[u]=[s],t.apply(null,o.concat([function(){n[u]=arguments;var t=r[u];delete r[u];for(var e=0,i=t.length;i>e;e++)t[e].apply(null,arguments)}])))};return o.memo=n,o.unmemoized=t,o},i.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},i.times=function(t,e,n){for(var r=[],o=0;t>o;o++)r.push(o);return i.map(r,e,n)},i.timesSeries=function(t,e,n){for(var r=[],o=0;t>o;o++)r.push(o);return i.mapSeries(r,e,n)},i.seq=function(){var t=arguments;return function(){var e=this,n=Array.prototype.slice.call(arguments),r=n.pop();i.reduce(t,n,function(t,n,r){n.apply(e,t.concat([function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);r(t,e)}]))},function(t,n){r.apply(e,[t].concat(n))})}},i.compose=function(){return i.seq.apply(null,Array.prototype.reverse.call(arguments))};var A=function(t,e){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return t(e,function(t,e){t.apply(n,r.concat([e]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};i.applyEach=h(A),i.applyEachSeries=d(A),i.forever=function(t,e){function n(r){if(r){if(e)return e(r);throw r}t(n)}n()},"undefined"!=typeof module&&module.exports?module.exports=i:"undefined"!=typeof n&&n.amd?n("async",[],function(){return i}):e.async=i}(),!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof n&&n.amd)n("buffer",t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.buffer=t()}}(function(){return function t(n,r,i){function o(u,a){if(!r[u]){if(!n[u]){var f="function"==typeof e&&e;if(!a&&f)return f(u,!0);if(s)return s(u,!0);throw new Error("Cannot find module '"+u+"'")}var l=r[u]={exports:{}};n[u][0].call(l.exports,function(t){var e=n[u][1][t];return o(e?e:t)},l,l.exports,t,n,r,i)}return r[u].exports}for(var s="function"==typeof e&&e,u=0;u<i.length;u++)o(i[u]);return o}({1:[function(t,e,n){function r(t,e,n){if(!(this instanceof r))return new r(t,e,n);var i=typeof t;if("base64"===e&&"string"===i)for(t=S(t);t.length%4!==0;)t+="=";var o;if("number"===i)o=x(t);else if("string"===i)o=r.byteLength(t,e);else{if("object"!==i)throw new Error("First argument needs to be a number, array or string.");o=x(t.length)}var s;r._useTypedArrays?s=F(new Uint8Array(o)):(s=this,s.length=o,s._isBuffer=!0);var u;if(r._useTypedArrays&&"function"==typeof Uint8Array&&t instanceof Uint8Array)s._set(t);else if(U(t))for(u=0;o>u;u++)s[u]=r.isBuffer(t)?t.readUInt8(u):t[u];else if("string"===i)s.write(t,0,e);else if("number"===i&&!r._useTypedArrays&&!n)for(u=0;o>u;u++)s[u]=0;return s}function i(t,e,n,i){n=Number(n)||0;var o=t.length-n;i?(i=Number(i),i>o&&(i=o)):i=o;var s=e.length;D(s%2===0,"Invalid hex string"),i>s/2&&(i=s/2);for(var u=0;i>u;u++){var a=parseInt(e.substr(2*u,2),16);D(!isNaN(a),"Invalid hex string"),t[n+u]=a}return r._charsWritten=2*u,u}function o(t,e,n,i){var o=r._charsWritten=M(C(e),t,n,i);return o}function s(t,e,n,i){var o=r._charsWritten=M(j(e),t,n,i);return o}function u(t,e,n,r){return s(t,e,n,r)}function a(t,e,n,i){var o=r._charsWritten=M(O(e),t,n,i);return o}function f(t,e,n){return R.fromByteArray(0===e&&n===t.length?t:t.slice(e,n))}function l(t,e,n){var r="",i="";n=Math.min(t.length,n);for(var o=e;n>o;o++)t[o]<=127?(r+=N(i)+String.fromCharCode(t[o]),i=""):i+="%"+t[o].toString(16);return r+N(i)}function c(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;n>i;i++)r+=String.fromCharCode(t[i]);return r}function h(t,e,n){return c(t,e,n)}function p(t,e,n){var r=t.length;(!e||0>e)&&(e=0),(!n||0>n||n>r)&&(n=r);for(var i="",o=e;n>o;o++)i+=T(t[o]);return i}function d(t,e,n,r){r||(D("boolean"==typeof n,"missing or invalid endian"),D(void 0!==e&&null!==e,"missing offset"),D(e+1<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var o;return n?(o=t[e],i>e+1&&(o|=t[e+1]<<8)):(o=t[e]<<8,i>e+1&&(o|=t[e+1])),o}}function y(t,e,n,r){r||(D("boolean"==typeof n,"missing or invalid endian"),D(void 0!==e&&null!==e,"missing offset"),D(e+3<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var o;return n?(i>e+2&&(o=t[e+2]<<16),i>e+1&&(o|=t[e+1]<<8),o|=t[e],i>e+3&&(o+=t[e+3]<<24>>>0)):(i>e+1&&(o=t[e+1]<<16),i>e+2&&(o|=t[e+2]<<8),i>e+3&&(o|=t[e+3]),o+=t[e]<<24>>>0),o}}function g(t,e,n,r){r||(D("boolean"==typeof n,"missing or invalid endian"),D(void 0!==e&&null!==e,"missing offset"),D(e+1<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var o=d(t,e,n,!0),s=32768&o;return s?-1*(65535-o+1):o}}function v(t,e,n,r){r||(D("boolean"==typeof n,"missing or invalid endian"),D(void 0!==e&&null!==e,"missing offset"),D(e+3<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var o=y(t,e,n,!0),s=2147483648&o;return s?-1*(4294967295-o+1):o}}function m(t,e,n,r){return r||(D("boolean"==typeof n,"missing or invalid endian"),D(e+3<t.length,"Trying to read beyond buffer length")),Q.read(t,e,n,23,4)}function w(t,e,n,r){return r||(D("boolean"==typeof n,"missing or invalid endian"),D(e+7<t.length,"Trying to read beyond buffer length")),Q.read(t,e,n,52,8)}function _(t,e,n,r,i){i||(D(void 0!==e&&null!==e,"missing value"),D("boolean"==typeof r,"missing or invalid endian"),D(void 0!==n&&null!==n,"missing offset"),D(n+1<t.length,"trying to write beyond buffer length"),z(e,65535));var o=t.length;if(!(n>=o))for(var s=0,u=Math.min(o-n,2);u>s;s++)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function b(t,e,n,r,i){i||(D(void 0!==e&&null!==e,"missing value"),D("boolean"==typeof r,"missing or invalid endian"),D(void 0!==n&&null!==n,"missing offset"),D(n+3<t.length,"trying to write beyond buffer length"),z(e,4294967295));var o=t.length;if(!(n>=o))for(var s=0,u=Math.min(o-n,4);u>s;s++)t[n+s]=e>>>8*(r?s:3-s)&255}function E(t,e,n,r,i){i||(D(void 0!==e&&null!==e,"missing value"),D("boolean"==typeof r,"missing or invalid endian"),D(void 0!==n&&null!==n,"missing offset"),D(n+1<t.length,"Trying to write beyond buffer length"),P(e,32767,-32768));var o=t.length;n>=o||(e>=0?_(t,e,n,r,i):_(t,65535+e+1,n,r,i))}function A(t,e,n,r,i){i||(D(void 0!==e&&null!==e,"missing value"),D("boolean"==typeof r,"missing or invalid endian"),D(void 0!==n&&null!==n,"missing offset"),D(n+3<t.length,"Trying to write beyond buffer length"),P(e,2147483647,-2147483648));var o=t.length;n>=o||(e>=0?b(t,e,n,r,i):b(t,4294967295+e+1,n,r,i))}function I(t,e,n,r,i){i||(D(void 0!==e&&null!==e,"missing value"),D("boolean"==typeof r,"missing or invalid endian"),D(void 0!==n&&null!==n,"missing offset"),D(n+3<t.length,"Trying to write beyond buffer length"),q(e,3.4028234663852886e38,-3.4028234663852886e38));var o=t.length;n>=o||Q.write(t,e,n,r,23,4)}function L(t,e,n,r,i){i||(D(void 0!==e&&null!==e,"missing value"),D("boolean"==typeof r,"missing or invalid endian"),D(void 0!==n&&null!==n,"missing offset"),D(n+7<t.length,"Trying to write beyond buffer length"),q(e,1.7976931348623157e308,-1.7976931348623157e308));var o=t.length;n>=o||Q.write(t,e,n,r,52,8)}function S(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function F(t){return t._isBuffer=!0,t._get=t.get,t._set=t.set,t.get=W.get,t.set=W.set,t.write=W.write,t.toString=W.toString,t.toLocaleString=W.toString,t.toJSON=W.toJSON,t.copy=W.copy,t.slice=W.slice,t.readUInt8=W.readUInt8,t.readUInt16LE=W.readUInt16LE,t.readUInt16BE=W.readUInt16BE,t.readUInt32LE=W.readUInt32LE,t.readUInt32BE=W.readUInt32BE,t.readInt8=W.readInt8,t.readInt16LE=W.readInt16LE,t.readInt16BE=W.readInt16BE,t.readInt32LE=W.readInt32LE,t.readInt32BE=W.readInt32BE,t.readFloatLE=W.readFloatLE,t.readFloatBE=W.readFloatBE,t.readDoubleLE=W.readDoubleLE,t.readDoubleBE=W.readDoubleBE,t.writeUInt8=W.writeUInt8,t.writeUInt16LE=W.writeUInt16LE,t.writeUInt16BE=W.writeUInt16BE,t.writeUInt32LE=W.writeUInt32LE,t.writeUInt32BE=W.writeUInt32BE,t.writeInt8=W.writeInt8,t.writeInt16LE=W.writeInt16LE,t.writeInt16BE=W.writeInt16BE,t.writeInt32LE=W.writeInt32LE,t.writeInt32BE=W.writeInt32BE,t.writeFloatLE=W.writeFloatLE,t.writeFloatBE=W.writeFloatBE,t.writeDoubleLE=W.writeDoubleLE,t.writeDoubleBE=W.writeDoubleBE,t.fill=W.fill,t.inspect=W.inspect,t.toArrayBuffer=W.toArrayBuffer,t}function B(t,e,n){return"number"!=typeof t?n:(t=~~t,t>=e?e:t>=0?t:(t+=e,t>=0?t:0))}function x(t){return t=~~Math.ceil(+t),0>t?0:t}function k(t){return(Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)})(t)}function U(t){return k(t)||r.isBuffer(t)||t&&"object"==typeof t&&"number"==typeof t.length}function T(t){return 16>t?"0"+t.toString(16):t.toString(16)}function C(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(127>=r)e.push(t.charCodeAt(n));else{var i=n;r>=55296&&57343>=r&&n++;for(var o=encodeURIComponent(t.slice(i,n+1)).substr(1).split("%"),s=0;s<o.length;s++)e.push(parseInt(o[s],16))}}return e}function j(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e}function O(t){return R.toByteArray(t)}function M(t,e,n,r){for(var i=0;r>i&&!(i+n>=e.length||i>=t.length);i++)e[i+n]=t[i];return i}function N(t){try{return decodeURIComponent(t)}catch(e){return String.fromCharCode(65533)}}function z(t,e){D("number"==typeof t,"cannot write a non-number as a number"),D(t>=0,"specified a negative value for writing an unsigned value"),D(e>=t,"value is larger than maximum value for type"),D(Math.floor(t)===t,"value has a fractional component")}function P(t,e,n){D("number"==typeof t,"cannot write a non-number as a number"),D(e>=t,"value larger than maximum allowed value"),D(t>=n,"value smaller than minimum allowed value"),D(Math.floor(t)===t,"value has a fractional component")}function q(t,e,n){D("number"==typeof t,"cannot write a non-number as a number"),D(e>=t,"value larger than maximum allowed value"),D(t>=n,"value smaller than minimum allowed value")}function D(t,e){if(!t)throw new Error(e||"Failed assertion")}var R=t("base64-js"),Q=t("ieee754");n.Buffer=r,n.SlowBuffer=r,n.INSPECT_MAX_BYTES=50,r.poolSize=8192,r._useTypedArrays=function(){if("undefined"==typeof Uint8Array||"undefined"==typeof ArrayBuffer)return!1;try{var t=new Uint8Array(0);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(e){return!1}}(),r.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.isBuffer=function(t){return!(null===t||void 0===t||!t._isBuffer)},r.byteLength=function(t,e){var n;switch(t+="",e||"utf8"){case"hex":n=t.length/2;break;case"utf8":case"utf-8":n=C(t).length;break;case"ascii":case"binary":case"raw":n=t.length;break;case"base64":n=O(t).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*t.length;break;default:throw new Error("Unknown encoding")}return n},r.concat=function(t,e){if(D(k(t),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===t.length)return new r(0);if(1===t.length)return t[0];var n;if("number"!=typeof e)for(e=0,n=0;n<t.length;n++)e+=t[n].length;var i=new r(e),o=0;for(n=0;n<t.length;n++){var s=t[n];s.copy(i,o),o+=s.length}return i},r.prototype.write=function(t,e,n,r){if(isFinite(e))isFinite(n)||(r=n,n=void 0);else{var f=r;r=e,e=n,n=f}e=Number(e)||0;var l=this.length-e;switch(n?(n=Number(n),n>l&&(n=l)):n=l,r=String(r||"utf8").toLowerCase()){case"hex":return i(this,t,e,n);case"utf8":case"utf-8":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o(this,t,e,n);case"ascii":return s(this,t,e,n);case"binary":return u(this,t,e,n);case"base64":return a(this,t,e,n);default:throw new Error("Unknown encoding")}},r.prototype.toString=function(t,e,n){var r=this;if(t=String(t||"utf8").toLowerCase(),e=Number(e)||0,n=void 0!==n?Number(n):n=r.length,n===e)return"";switch(t){case"hex":return p(r,e,n);case"utf8":case"utf-8":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l(r,e,n);case"ascii":return c(r,e,n);case"binary":return h(r,e,n);case"base64":return f(r,e,n);default:throw new Error("Unknown encoding")}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},r.prototype.copy=function(t,e,n,r){var i=this;if(n||(n=0),r||0===r||(r=this.length),e||(e=0),r!==n&&0!==t.length&&0!==i.length){D(r>=n,"sourceEnd < sourceStart"),D(e>=0&&e<t.length,"targetStart out of bounds"),D(n>=0&&n<i.length,"sourceStart out of bounds"),D(r>=0&&r<=i.length,"sourceEnd out of bounds"),r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);for(var o=0;r-n>o;o++)t[o+e]=this[o+n]}},r.prototype.slice=function(t,e){var n=this.length;if(t=B(t,n,0),e=B(e,n,n),r._useTypedArrays)return F(this.subarray(t,e));for(var i=e-t,o=new r(i,void 0,!0),s=0;i>s;s++)o[s]=this[s+t];return o},r.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},r.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e)},r.prototype.readUInt8=function(t,e){return e||(D(void 0!==t&&null!==t,"missing offset"),D(t<this.length,"Trying to read beyond buffer length")),t>=this.length?void 0:this[t]},r.prototype.readUInt16LE=function(t,e){return d(this,t,!0,e)},r.prototype.readUInt16BE=function(t,e){return d(this,t,!1,e)},r.prototype.readUInt32LE=function(t,e){return y(this,t,!0,e)},r.prototype.readUInt32BE=function(t,e){return y(this,t,!1,e)},r.prototype.readInt8=function(t,e){if(e||(D(void 0!==t&&null!==t,"missing offset"),D(t<this.length,"Trying to read beyond buffer length")),!(t>=this.length)){var n=128&this[t];return n?-1*(255-this[t]+1):this[t]}},r.prototype.readInt16LE=function(t,e){return g(this,t,!0,e)},r.prototype.readInt16BE=function(t,e){return g(this,t,!1,e)},r.prototype.readInt32LE=function(t,e){return v(this,t,!0,e)},r.prototype.readInt32BE=function(t,e){return v(this,t,!1,e)},r.prototype.readFloatLE=function(t,e){return m(this,t,!0,e)},r.prototype.readFloatBE=function(t,e){return m(this,t,!1,e)},r.prototype.readDoubleLE=function(t,e){return w(this,t,!0,e)},r.prototype.readDoubleBE=function(t,e){return w(this,t,!1,e)},r.prototype.writeUInt8=function(t,e,n){n||(D(void 0!==t&&null!==t,"missing value"),D(void 0!==e&&null!==e,"missing offset"),D(e<this.length,"trying to write beyond buffer length"),z(t,255)),e>=this.length||(this[e]=t)},r.prototype.writeUInt16LE=function(t,e,n){_(this,t,e,!0,n)},r.prototype.writeUInt16BE=function(t,e,n){_(this,t,e,!1,n)},r.prototype.writeUInt32LE=function(t,e,n){b(this,t,e,!0,n)},r.prototype.writeUInt32BE=function(t,e,n){b(this,t,e,!1,n)},r.prototype.writeInt8=function(t,e,n){n||(D(void 0!==t&&null!==t,"missing value"),D(void 0!==e&&null!==e,"missing offset"),D(e<this.length,"Trying to write beyond buffer length"),P(t,127,-128)),e>=this.length||(t>=0?this.writeUInt8(t,e,n):this.writeUInt8(255+t+1,e,n))},r.prototype.writeInt16LE=function(t,e,n){E(this,t,e,!0,n)},r.prototype.writeInt16BE=function(t,e,n){E(this,t,e,!1,n)},r.prototype.writeInt32LE=function(t,e,n){A(this,t,e,!0,n)},r.prototype.writeInt32BE=function(t,e,n){A(this,t,e,!1,n)},r.prototype.writeFloatLE=function(t,e,n){I(this,t,e,!0,n)},r.prototype.writeFloatBE=function(t,e,n){I(this,t,e,!1,n)},r.prototype.writeDoubleLE=function(t,e,n){L(this,t,e,!0,n)},r.prototype.writeDoubleBE=function(t,e,n){L(this,t,e,!1,n)},r.prototype.fill=function(t,e,n){if(t||(t=0),e||(e=0),n||(n=this.length),"string"==typeof t&&(t=t.charCodeAt(0)),D("number"==typeof t&&!isNaN(t),"value is not a number"),D(n>=e,"end < start"),n!==e&&0!==this.length){D(e>=0&&e<this.length,"start out of bounds"),D(n>=0&&n<=this.length,"end out of bounds");for(var r=e;n>r;r++)this[r]=t}},r.prototype.inspect=function(){for(var t=[],e=this.length,r=0;e>r;r++)if(t[r]=T(this[r]),r===n.INSPECT_MAX_BYTES){t[r+1]="...";break}return"<Buffer "+t.join(" ")+">"},r.prototype.toArrayBuffer=function(){if("function"==typeof Uint8Array){if(r._useTypedArrays)return new r(this).buffer;for(var t=new Uint8Array(this.length),e=0,n=t.length;n>e;e+=1)t[e]=this[e];return t.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var W=r.prototype},{"base64-js":2,ieee754:3}],2:[function(t,e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(){function t(t){var e=t.charCodeAt(0);return e===s?62:e===u?63:a>e?-1:a+10>e?e-a+26+26:l+26>e?e-l:f+26>e?e-f+26:void 0}function r(e){function n(t){f[c++]=t}var r,i,s,u,a,f;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var l=e.length;a="="===e.charAt(l-2)?2:"="===e.charAt(l-1)?1:0,f=new o(3*e.length/4-a),s=a>0?e.length-4:e.length;var c=0;for(r=0,i=0;s>r;r+=4,i+=3)u=t(e.charAt(r))<<18|t(e.charAt(r+1))<<12|t(e.charAt(r+2))<<6|t(e.charAt(r+3)),n((16711680&u)>>16),n((65280&u)>>8),n(255&u);return 2===a?(u=t(e.charAt(r))<<2|t(e.charAt(r+1))>>4,n(255&u)):1===a&&(u=t(e.charAt(r))<<10|t(e.charAt(r+1))<<4|t(e.charAt(r+2))>>2,n(u>>8&255),n(255&u)),f}function i(t){function e(t){return n.charAt(t)}function r(t){return e(t>>18&63)+e(t>>12&63)+e(t>>6&63)+e(63&t)}var i,o,s,u=t.length%3,a="";for(i=0,s=t.length-u;s>i;i+=3)o=(t[i]<<16)+(t[i+1]<<8)+t[i+2],a+=r(o);switch(u){case 1:o=t[t.length-1],a+=e(o>>2),a+=e(o<<4&63),a+="==";break;case 2:o=(t[t.length-2]<<8)+t[t.length-1],a+=e(o>>10),a+=e(o>>4&63),a+=e(o<<2&63),a+="="}return a}var o="undefined"!=typeof Uint8Array?Uint8Array:Array,s=("0".charCodeAt(0),"+".charCodeAt(0)),u="/".charCodeAt(0),a="0".charCodeAt(0),f="a".charCodeAt(0),l="A".charCodeAt(0);e.exports.toByteArray=r,e.exports.fromByteArray=i}()},{}],3:[function(t,e,n){n.read=function(t,e,n,r,i){var o,s,u=8*i-r-1,a=(1<<u)-1,f=a>>1,l=-7,c=n?i-1:0,h=n?-1:1,p=t[e+c];for(c+=h,o=p&(1<<-l)-1,p>>=-l,l+=u;l>0;o=256*o+t[e+c],c+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+t[e+c],c+=h,l-=8);if(0===o)o=1-f;else{if(o===a)return s?0/0:1/0*(p?-1:1);s+=Math.pow(2,r),o-=f}return(p?-1:1)*s*Math.pow(2,o-r)},n.write=function(t,e,n,r,i,o){var s,u,a,f=8*o-i-1,l=(1<<f)-1,c=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,y=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(u=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-s))<1&&(s--,a*=2),e+=s+c>=1?h/a:h*Math.pow(2,1-c),e*a>=2&&(s++,a/=2),s+c>=l?(u=0,s=l):s+c>=1?(u=(e*a-1)*Math.pow(2,i),s+=c):(u=e*Math.pow(2,c-1)*Math.pow(2,i),s=0));i>=8;t[n+p]=255&u,p+=d,u/=256,i-=8);for(s=s<<i|u,f+=i;f>0;t[n+p]=255&s,p+=d,s/=256,f-=8);t[n+p-d]|=128*y}},{}],4:[function(t,e){e.exports=t("buffer")},{buffer:1}]},{},[4])(4)}),n("cofs/array2buffer",["buffer"],function(t){var e=t.Buffer,n=function(t){var n,r,i,o,s;if(s=new Int8Array(t),o=new e(s),i=t.byteLength,o.length||!i)return s=null,o;for(o=new e(i),n=0;i>n;n++)r=s[n],o.writeUInt8(r,n);return s=null,o};return n}),n("cofs/promise",[],function(){var t=function(t){if("function"!=typeof t)throw new Error("Listener not defined");return function(){var e=Array.prototype.slice.call(arguments);t.apply({},e)}};return t}),!function(){function t(){this._events={},this._conf&&e.call(this,this._conf)
}function e(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners&&(this._events.maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this.newListener=t.newListener),this.wildcard&&(this.listenerTree={}))}function r(t){this._events={},this.newListener=!1,e.call(this,t)}function i(t,e,n,r){if(!n)return[];var o,s,u,a,f,l,c,h=[],p=e.length,d=e[r],y=e[r+1];if(r===p&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(o=0,s=n._listeners.length;s>o;o++)t&&t.push(n._listeners[o]);return[n]}if("*"===d||"**"===d||n[d]){if("*"===d){for(u in n)"_listeners"!==u&&n.hasOwnProperty(u)&&(h=h.concat(i(t,e,n[u],r+1)));return h}if("**"===d){c=r+1===p||r+2===p&&"*"===y,c&&n._listeners&&(h=h.concat(i(t,e,n,p)));for(u in n)"_listeners"!==u&&n.hasOwnProperty(u)&&("*"===u||"**"===u?(n[u]._listeners&&!c&&(h=h.concat(i(t,e,n[u],p))),h=h.concat(i(t,e,n[u],r))):h=h.concat(u===y?i(t,e,n[u],r+2):i(t,e,n[u],r)));return h}h=h.concat(i(t,e,n[d],r+1))}if(a=n["*"],a&&i(t,e,a,r+1),f=n["**"])if(p>r){f._listeners&&i(t,e,f,p);for(u in f)"_listeners"!==u&&f.hasOwnProperty(u)&&(u===y?i(t,e,f[u],r+2):u===d?i(t,e,f[u],r+1):(l={},l[u]=f[u],i(t,e,{"**":l},r+1)))}else f._listeners?i(t,e,f,p):f["*"]&&f["*"]._listeners&&i(t,e,f["*"],p);return h}function o(t,e){t="string"==typeof t?t.split(this.delimiter):t.slice();for(var n=0,r=t.length;r>n+1;n++)if("**"===t[n]&&"**"===t[n+1])return;for(var i=this.listenerTree,o=t.shift();o;){if(i[o]||(i[o]={}),i=i[o],0===t.length){if(i._listeners){if("function"==typeof i._listeners)i._listeners=[i._listeners,e];else if(s(i._listeners)&&(i._listeners.push(e),!i._listeners.warned)){var a=u;"undefined"!=typeof this._events.maxListeners&&(a=this._events.maxListeners),a>0&&i._listeners.length>a&&(i._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",i._listeners.length),console.trace())}}else i._listeners=e;return!0}o=t.shift()}return!0}var s=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},u=10;r.prototype.delimiter=".",r.prototype.setMaxListeners=function(e){this._events||t.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},r.prototype.event="",r.prototype.once=function(t,e){return this.many(t,1,e),this},r.prototype.many=function(t,e,n){function r(){0===--e&&i.off(t,r),n.apply(this,arguments)}var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(t,r),i},r.prototype.emit=function(){this._events||t.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];for(o=0,n=this._all.length;n>o;o++)this.event=e,this._all[o].apply(this,r)}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var u="string"==typeof e?e.split(this.delimiter):e.slice();i.call(this,s,u,this.listenerTree,0)}else s=this._events[e];if("function"==typeof s){if(this.event=e,1===arguments.length)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];s.apply(this,r)}return!0}if(s){for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];for(var a=s.slice(),o=0,n=a.length;n>o;o++)this.event=e,a[o].apply(this,r);return a.length>0||!!this._all}return!!this._all},r.prototype.on=function(e,n){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");if(this._events||t.call(this),this.emit("newListener",e,n),this.wildcard)return o.call(this,e,n),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],n];else if(s(this._events[e])&&(this._events[e].push(n),!this._events[e].warned)){var r=u;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=n;return this},r.prototype.onAny=function(t){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(t),this},r.prototype.addListener=r.prototype.on,r.prototype.off=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var o="string"==typeof t?t.split(this.delimiter):t.slice();r=i.call(this,null,o,this.listenerTree,0)}else{if(!this._events[t])return this;n=this._events[t],r.push({_listeners:n})}for(var u=0;u<r.length;u++){var a=r[u];if(n=a._listeners,s(n)){for(var f=-1,l=0,c=n.length;c>l;l++)if(n[l]===e||n[l].listener&&n[l].listener===e||n[l]._origin&&n[l]._origin===e){f=l;break}if(0>f)continue;return this.wildcard?a._listeners.splice(f,1):this._events[t].splice(f,1),0===n.length&&(this.wildcard?delete a._listeners:delete this._events[t]),this}(n===e||n.listener&&n.listener===e||n._origin&&n._origin===e)&&(this.wildcard?delete a._listeners:delete this._events[t])}return this},r.prototype.offAny=function(t){var e,n=0,r=0;if(t&&this._all&&this._all.length>0){for(e=this._all,n=0,r=e.length;r>n;n++)if(t===e[n])return e.splice(n,1),this}else this._all=[];return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||t.call(this),this;if(this.wildcard)for(var n="string"==typeof e?e.split(this.delimiter):e.slice(),r=i.call(this,null,n,this.listenerTree,0),o=0;o<r.length;o++){var s=r[o];s._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},r.prototype.listeners=function(e){if(this.wildcard){var n=[],r="string"==typeof e?e.split(this.delimiter):e.slice();return i.call(this,n,r,this.listenerTree,0),n}return this._events||t.call(this),this._events[e]||(this._events[e]=[]),s(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof n&&n.amd?n("eventemitter2",[],function(){return r}):"object"==typeof exports?exports.EventEmitter2=r:window.EventEmitter2=r}(),n("cofs/readstream",["async","eventemitter2"],function(t,e){var n,r,i=function(){Error.call(this)};i.prototype=new Error;var o=function(){this.initialize.apply(this,arguments)};return o.prototype=new e,o.prototype.initialize=function(t,i,o){if(e.call(this),o=o||{},n=window.File||void 0,r=window.Blob||void 0,"undefined"==typeof n)throw new Error("File componet does not exits");if("undefined"==typeof r)throw new Error("Blob componet does not exists");if(this._fs=t,this._file=i,this._blockSize=o.blockSize||4096,this._start=o.start||0,this._end=void 0!==o.end?o.end:void 0,this._paused=!1,this._stoped=!1,this._end<=this._start)throw new Error("Start byte has been bigger that end byte")},o.prototype._error=function(t){var e=this.emit("error",t);if(!e)throw t},o.prototype.getFile=function(t){var e=this._fs,i=this._file;return i instanceof n||i instanceof r?t(void 0,i):void e.getFileEntry(i,function(e,n){return e?t(e):void n.file(function(e){return t(void 0,e)})})},o.prototype.start=function(){var e=this,n=this._start,r=this._end,o=this._blockSize;this.getFile(function(s,u){if(s)return e._error(s);e.emit("debug","Starting strean for "+u.fullPath),"undefined"==typeof r&&(r=u.size);var a=n;t.whilst(function(){return r>=a},function(t){var n=function(n){return e.emit("debug","Sending data block"),e.emit("data",n),t()};e._fs.readFilePart(u,a,a+o,function(r,s){return a+=o,r?void t(r):e._paused?(e.emit("debug","Is paused, wating resume event to send data"),e.once("resume",function(){e.emit("resumed, sending data"),n(s)})):e._stoped?(e.emit("Is stoped, throwing"),t(new i)):void n(s)})},function(t){return t instanceof i?void 0:t?e._error(t):(e.emit("Finished"),e._paused?(e.emit("Are finished but is paused, waiting."),void e.once("resume",function(){return e.emit("debug","resumed, sending finish"),e.emit("finish")})):(e.emit("Sending finish"),e.emit("finish")))})})},o.prototype.pause=function(){this._paused=!0,this.emit("pause")},o.prototype.resume=function(){this._paused=!1,this.emit("resume")},o.prototype.stop=function(){this._stoped=!0,this.emit("stop")},o}),n("cofs/writestream",["buffer","async","eventemitter2"],function(t,e,n){var r,i,o=t.Buffer,s=function(){Error.call(this)};s.prototype=new Error;var u=function(){this.initialize.apply(this,arguments)};return u.prototype=new n,u.prototype.initialize=function(t,o,s){var u=this;if(n.call(this),s=s||{},r=window.File||void 0,i=window.Blob||void 0,"undefined"==typeof r)throw new Error("File componet does not exits");if("undefined"==typeof i)throw new Error("Blob componet does not exists");this._fs=t,this._file=o,this._start=s.start||0,this._ready=!1,this._starting=!1,this._last=0,this._paused=!1,this._stoped=!1,this._writeQueue=e.queue(function(t,e){u._fs.writeFilePart(u._file,t,e)},1),this._writeQueue.pause(),this._writeQueue.drain=function(){u.emit("drain")},this._init()},u.prototype._error=function(t){var e=this.emit("error",t);if(!e)throw t},u.prototype._init=function(){var t=this;this._starting||(this._starting=!0,this._fs.writeFile(this._file,new o(0),function(e){return e?void t._error(e):void(t._paused||(t.emit("ready"),t._writeQueue.resume()))}))},u.prototype.write=function(t,e,n){var r=this;o.isBuffer(t)?(n=e,e=void 0):t=new o(t,e),n=n||function(t){r._error(t)},this._writeQueue.push(t,n)},u.prototype.getFile=function(t){var e=this._fs,n=this._file;return n instanceof r||n instanceof i?t(void 0,n):void e.getFileEntry(n,function(e,n){return e?t(e):void n.file(function(e){return t(void 0,e)})})},u.prototype.resume=function(){this._writeQueue.resume(),this.emit("resume")},u.prototype.pause=function(){this._paused=!0,this._writeQueue.pause(),this.emit("pause")},u.prototype.stop=function(){this._stoped=!0,this._writeQueue.kill(),this.emit("stop")},u}),n("cofs/fs",["async","buffer","./array2buffer","./promise","./readstream","./writestream"],function(t,e,n,r,i,o){var s=e.Buffer,u=null,a=null,f=null,l=function(t,e){return e&&"buffer"!==e?t.toString(e):t},c=function(t){if(u||(u=window.FileReader||null),a||(a=window.requestFileSystem||window.webkitRequestFileSystem||null),f||(f=window.File||null),!u||!f)throw new Error("Objects of file API does not exists!");this._eventsListeners={},this._fs=null,t=t||{},this._options=t};return c.VERSION="0.5.4",c.prototype._log=function(){this._options.logger&&this._options.logger.apply({},arguments)},c.prototype._error=function(t){if("object"!=typeof t&&(t=new Error(t)),this._log("CoFS Error"+t.message),!this.emit("error",t))throw t;return t},c.prototype.on=function(t,e,n){"undefined"==typeof this._eventsListeners[t]&&(this._eventsListeners[t]=[]),this._eventsListeners[t].push({cb:e,once:n||!1})},c.prototype.once=function(t,e){return this.on(t,e,!0)},c.prototype.emit=function(){if(!arguments.length)return!1;var t,e=Array.prototype.slice.call(arguments,0),n=e.shift(),r=this._eventsListeners[n]||[];for(this._log("emiting "+n),t=0;t<e.length;t++)r[t]&&(r[t].cb.apply(this,e),r[t].once&&(r[t]=null));return t},c.prototype.getFileSystem=function(t,e){var n=this;if(!a)return e(new Error("The browser has not requestFileSystem"));if("function"==typeof t&&(e=t,t=void 0),t=t||{},this._log("Open FileSystem",t),this._fs&&!t.force)return e(null,this._fs);var r=t.fs||this._options.fs||"PERSISTENT",i=t.quota||this._options.quota||0;a(window[r],i,function(t){n._fs=t,e(null,t)},function(t){n._log("Error getting FileSystem",t),n._error(t),e(t)})},c.prototype.getDirectory=function(t,e,n){var r=this;"function"==typeof e&&(n=e,e=void 0);var i=!1;e=e||{},this.getFileSystem(function(o,s){var u;u=e.root?e.root:r._options.root?r._options.root:s.root,u.getDirectory(t,e,function(t){return i?void 0:(i=!0,n(void 0,t))},function(t){return i?void 0:(i=!0,r._log("Error getting directory entry",t),r._error(t),n(t))})})},c.prototype.getFileEntry=function(t,e,n){var r=this;return"function"==typeof e&&(n=e,e=void 0),e=e||{},this._log("Getting FileEntry for",t,e),"object"==typeof t?n(null,t):void this.getFileSystem(function(i,o){var s;return i?n(i):(s=e.root||r._options.root||o.root,void s.getFile(t,e,function(e){r.emit("fileentry:"+t,e),n(null,e)},function(t){r._log("Error getting FileEntry",t),n(t)}))})},c.prototype.readFromFileObject=function(t,e,r){var i=this;"function"==typeof e&&(r=e,e=void 0),this._log("Creating filereader object",t);var o=new u;return e=e||{},o.onloadend=function(){if(i._log("load end call! with large (relative): ",this.result.length),!this.result)return null;var t=n(this.result);r(null,l(t,e.outEncode))},o.onerror=function(t){i._log("Error Reading file",t),r(new Error("Reading file"))},o.onabort=function(){i._log("Reading file Abort!!"),r(new Error("Reading abort"))},o.readAsArrayBuffer(t),o},c.prototype.readFromFileEntry=function(t,e,n){var r=this;"function"==typeof e&&(n=e,e=void 0),e=e||{},t.file(function(t){r.readFromFileObject(t,e,n)})},c.prototype.readFile=function(t,e,n){var r=this;return"function"==typeof e&&(n=e,e=void 0),t instanceof f||t instanceof Blob?this.readFromFileObject(t,e,n):void this.getFileEntry(t,e,function(t,i){return t?n(t):void r.readFromFileEntry(i,e,n)})},c.prototype.writeFileObject=function(t,e,n,r){"function"==typeof n&&(r=n,n=void 0),s.isBuffer(e)||(e=new s(e,n.encode)),n=n||{},t.createWriter(function(t){t.onwriteend=function(){r(null)},t.onerror=function(t){r(new Error(t.toString()))};var n=new Blob([e],{type:"application/octet-stream"});t.write(n)},function(){r(new Error("Error writing "+t.toURL()))})},c.prototype.writeFile=function(t,e,n,r){var i=this;"function"==typeof n&&(r=n,n=void 0),n=n||{},n.create=!0,n.exclusive=!0,this.getFileEntry(t,n,function(t,o){return t?r(new Error("Error getting file access "+t.message)):void i.writeFileObject(o,e,n,r)})},c.prototype.readFilePart=function(t,e,n,r){if("function"!=typeof t.slice)if("function"===t.mozSlice)t.slice=t.mozSlice;else{if("function"!==t.webkitSlice){var i=this._error("File has not slice method");return r(i)}t.slice=t.webkitSlice}return this.readFromFileObject(t.slice(e,n),r)},c.prototype.writeFilePart=function(t,e,n,r,i){var o=this;"number"!=typeof e&&(i=r,r=n,n=e,e=null),s.isBuffer(n)?(i=r,r=void 0):n=new s(n,r),this.getFileSystem(function(r){if(r)return i(r);var s={create:!1,exclusive:!0};o.getFileEntry(t,s,function(r,o){return r?i(new Error("Error getting file access "+r.message)):void o.createWriter(function(t){e||(e=t.length),t.onwriteend=function(){i(null)},t.onerror=function(t){i(new Error(t.toString()))};var r=new Blob([n],{type:"application/octet-stream"});t.seek(e),t.write(r)},function(){i(new Error("Error writing "+t))})})})},c.prototype.createReadStream=function(t,e){var n=new i(this,t,e);return n},c.prototype.createWriteStream=function(t,e){var n=new o(this,t,e);return n},c}),e("cofs/fs")});