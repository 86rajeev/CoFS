/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,e){if("function"==typeof define&&define.amd)define(["async","buffer","eventemitter2"],e);else{var i=t.CoFS;t.CoFS=e(t.async,t.buffer,t.EventEmitter2),t.CoFS.noConflict=function(){return t.CoFS=i,CoFS}}}(this,function(t,e,i){var n,r,o;return function(t){function e(t,e){return _.call(t,e)}function i(t,e){var i,n,r,o,s,u,f,l,c,a,p,d=e&&e.split("/"),h=v.map,y=h&&h["*"]||{};if(t&&"."===t.charAt(0))if(e){for(d=d.slice(0,d.length-1),t=t.split("/"),s=t.length-1,v.nodeIdCompat&&F.test(t[s])&&(t[s]=t[s].replace(F,"")),t=d.concat(t),c=0;c<t.length;c+=1)if(p=t[c],"."===p)t.splice(c,1),c-=1;else if(".."===p){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((d||y)&&h){for(i=t.split("/"),c=i.length;c>0;c-=1){if(n=i.slice(0,c).join("/"),d)for(a=d.length;a>0;a-=1)if(r=h[d.slice(0,a).join("/")],r&&(r=r[n])){o=r,u=c;break}if(o)break;!f&&y&&y[n]&&(f=y[n],l=c)}!o&&f&&(o=f,u=l),o&&(i.splice(0,u,o),t=i.join("/"))}return t}function s(e,i){return function(){var n=b.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),d.apply(t,n.concat([e,i]))}}function u(t){return function(e){return i(e,t)}}function f(t){return function(e){g[t]=e}}function l(i){if(e(m,i)){var n=m[i];delete m[i],w[i]=!0,p.apply(t,n)}if(!e(g,i)&&!e(w,i))throw new Error("No "+i);return g[i]}function c(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function a(t){return function(){return v&&v.config&&v.config[t]||{}}}var p,d,h,y,g={},m={},v={},w={},_=Object.prototype.hasOwnProperty,b=[].slice,F=/\.js$/;h=function(t,e){var n,r=c(t),o=r[0];return t=r[1],o&&(o=i(o,e),n=l(o)),o?t=n&&n.normalize?n.normalize(t,u(e)):i(t,e):(t=i(t,e),r=c(t),o=r[0],t=r[1],o&&(n=l(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},y={require:function(t){return s(t)},exports:function(t){var e=g[t];return"undefined"!=typeof e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:a(t)}}},p=function(i,n,r,o){var u,c,a,p,d,v,_=[],b=typeof r;if(o=o||i,"undefined"===b||"function"===b){for(n=!n.length&&r.length?["require","exports","module"]:n,d=0;d<n.length;d+=1)if(p=h(n[d],o),c=p.f,"require"===c)_[d]=y.require(i);else if("exports"===c)_[d]=y.exports(i),v=!0;else if("module"===c)u=_[d]=y.module(i);else if(e(g,c)||e(m,c)||e(w,c))_[d]=l(c);else{if(!p.p)throw new Error(i+" missing "+c);p.p.load(p.n,s(o,!0),f(c),{}),_[d]=g[c]}a=r?r.apply(g[i],_):void 0,i&&(u&&u.exports!==t&&u.exports!==g[i]?g[i]=u.exports:a===t&&v||(g[i]=a))}else i&&(g[i]=r)},n=r=d=function(e,i,n,r,o){if("string"==typeof e)return y[e]?y[e](i):l(h(e,i).f);if(!e.splice){if(v=e,v.deps&&d(v.deps,v.callback),!i)return;i.splice?(e=i,i=n,n=null):e=t}return i=i||function(){},"function"==typeof n&&(n=r,r=o),r?p(t,e,i,n):setTimeout(function(){p(t,e,i,n)},4),d},d.config=function(t){return d(t)},n._defined=g,o=function(t,i,n){i.splice||(n=i,i=[]),e(g,t)||e(m,t)||(m[t]=[t,i,n])},o.amd={jQuery:!0}}(),o("node_modules/almond/almond",function(){}),o("cofs/array2buffer",["buffer"],function(t){var e=t.Buffer,i=function(t){var i,n,r,o,s;if(s=new Int8Array(t),o=new e(s),r=t.byteLength,o.length||!r)return s=null,o;for(o=new e(r),i=0;r>i;i++)n=s[i],o.writeUInt8(n,i);return s=null,o};return i}),o("cofs/promise",[],function(){var t=function(t){if("function"!=typeof t)throw new Error("Listener not defined");return function(){var e=Array.prototype.slice.call(arguments);t.apply({},e)}};return t}),o("cofs/readstream",["async","eventemitter2"],function(t,e){var i,n,r=function(){Error.call(this)};r.prototype=new Error;var o=function(){this.initialize.apply(this,arguments)};return o.prototype=new e,o.prototype.initialize=function(t,r,o){if(e.call(this),o=o||{},i=window.File||void 0,n=window.Blob||void 0,"undefined"==typeof i)throw new Error("File componet does not exits");if("undefined"==typeof n)throw new Error("Blob componet does not exists");if(this._fs=t,this._file=r,this._blockSize=o.blockSize||4096,this._start=o.start||0,this._end=void 0!==o.end?o.end:void 0,this._paused=!1,this._stoped=!1,this._end<=this._start)throw new Error("Start byte has been bigger that end byte")},o.prototype._error=function(t){var e=this.emit("error",t);if(!e)throw t},o.prototype.getFile=function(t){var e=this._fs,r=this._file;return r instanceof i||r instanceof n?t(void 0,r):void e.getFileEntry(r,function(e,i){return e?t(e):void i.file(function(e){return t(void 0,e)})})},o.prototype.start=function(){var e=this,i=this._start,n=this._end,o=this._blockSize;this.getFile(function(s,u){if(s)return e._error(s);e.emit("debug","Starting strean for "+u.fullPath),"undefined"==typeof n&&(n=u.size);var f=i;t.whilst(function(){return n>=f},function(t){var i=function(i){return e.emit("debug","Sending data block"),e.emit("data",i),t()};e._fs.readFilePart(u,f,f+o,function(n,s){return f+=o,n?void t(n):e._paused?(e.emit("debug","Is paused, wating resume event to send data"),e.once("resume",function(){e.emit("resumed, sending data"),i(s)})):e._stoped?(e.emit("Is stoped, throwing"),t(new r)):void i(s)})},function(t){return t instanceof r?void 0:t?e._error(t):(e.emit("Finished"),e._paused?(e.emit("Are finished but is paused, waiting."),void e.once("resume",function(){return e.emit("debug","resumed, sending finish"),e.emit("finish")})):(e.emit("Sending finish"),e.emit("finish")))})})},o.prototype.pause=function(){this._paused=!0,this.emit("pause")},o.prototype.resume=function(){this._paused=!1,this.emit("resume")},o.prototype.stop=function(){this._stoped=!0,this.emit("stop")},o}),o("cofs/writestream",["buffer","async","eventemitter2"],function(t,e,i){var n,r,o=t.Buffer,s=function(){Error.call(this)};s.prototype=new Error;var u=function(){this.initialize.apply(this,arguments)};return u.prototype=new i,u.prototype.initialize=function(t,o,s){var u=this;if(i.call(this),s=s||{},n=window.File||void 0,r=window.Blob||void 0,"undefined"==typeof n)throw new Error("File componet does not exits");if("undefined"==typeof r)throw new Error("Blob componet does not exists");this._fs=t,this._file=o,this._start=s.start||0,this._ready=!1,this._starting=!1,this._last=0,this._paused=!1,this._stoped=!1,this._writeQueue=e.queue(function(t,e){u._fs.writeFilePart(u._file,t,e)},1),this._writeQueue.pause(),this._writeQueue.drain=function(){u.emit("drain")},this._init()},u.prototype._error=function(t){var e=this.emit("error",t);if(!e)throw t},u.prototype._init=function(){var t=this;this._starting||(this._starting=!0,this._fs.writeFile(this._file,new o(0),function(e){return e?void t._error(e):void(t._paused||(t.emit("ready"),t._writeQueue.resume()))}))},u.prototype.write=function(t,e,i){var n=this;o.isBuffer(t)?(i=e,e=void 0):t=new o(t,e),i=i||function(t){n._error(t)},this._writeQueue.push(t,i)},u.prototype.getFile=function(t){var e=this._fs,i=this._file;return i instanceof n||i instanceof r?t(void 0,i):void e.getFileEntry(i,function(e,i){return e?t(e):void i.file(function(e){return t(void 0,e)})})},u.prototype.resume=function(){this._writeQueue.resume(),this.emit("resume")},u.prototype.pause=function(){this._paused=!0,this._writeQueue.pause(),this.emit("pause")},u.prototype.stop=function(){this._stoped=!0,this._writeQueue.kill(),this.emit("stop")},u}),o("cofs/fs",["async","buffer","./array2buffer","./promise","./readstream","./writestream"],function(t,e,i,n,r,o){var s=e.Buffer,u=null,f=null,l=null,c=function(){this.initialize.apply(this,arguments)};return c.VERSION="0.4.5",c.prototype.initialize=function(t){if(u||(u=window.FileReader||null),f||(f=window.requestFileSystem||window.webkitRequestFileSystem||null),l||(l=window.File||null),!u||!l)throw new Error("Objects of file API does not exists!");this._eventsListeners={},this._fs=null,t=t||{},this._options=t},c.prototype._log=function(){this._options.logger&&this._options.logger.apply({},arguments)},c.prototype._error=function(t){if("object"!=typeof t&&(t=new Error(t)),this._log("CoFS Error"+t.message),!this.emit("error",t))throw t;return t},c.prototype.on=function(t,e,i){"undefined"==typeof this._eventsListeners[t]&&(this._eventsListeners[t]=[]),this._eventsListeners[t].push({cb:e,once:i||!1})},c.prototype.once=function(t,e){return this.on(t,e,!0)},c.prototype.emit=function(){if(!arguments.length)return!1;var t,e=Array.prototype.slice.call(arguments,0),i=e.shift(),n=this._eventsListeners[i]||[];for(this._log("emiting "+i),t=0;t<e.length;t++)n[t]&&(n[t].cb.apply(this,e),n[t].once&&(n[t]=null));return t},c.prototype.getFileSystem=function(t,e){var i=this;return f?("function"==typeof t&&(e=t,t={}),this._log("Open FileSystem",t),void f(window[t.fs||"PERSISTENT"],0,function(t){i._fs=t,e(null,t)},function(t){i._log("Error getting FileSystem",t),i._error(t)})):e(new Error("The browser has not requestFileSystem"))},c.prototype.getDirectory=function(t,e,i){var n=this;"function"==typeof e&&(i=e,e=void 0);var r=!1;e=e||{},this.getFileSystem(function(o,s){s.root.getDirectory(t,e,function(t){return r?void 0:(r=!0,i(void 0,t))},function(t){return r?void 0:(r=!0,n._log("Error getting directory entry",t),n._error(t),i(t))})})},c.prototype.getFileEntry=function(t,e,i){"function"==typeof e&&(i=e,e={});var n=e.root||void 0;if(this._log("Getting FileEntry for",t,e),"object"==typeof t)return i(null,t);var r=this;this.getFileSystem(function(o,s){return o?i(o):("undefined"==typeof n&&(n=s.root),void n.getFile(t,e,function(e){r.emit("fileentry:"+t,e),i(null,e)},function(t){r._log("Error getting FileEntry",t),i(t)}))})},c.prototype.readFromFileObject=function(t,e){var n=this;this._log("Creating filereader object",t);var r=new u;r.onloadend=function(){if(n._log("load end call! with large (relative): ",this.result.length),!this.result)return null;var t=i(this.result);e(null,t)},r.onerror=function(t){n._log("Error Reading file",t),e(new Error("Reading file"))},r.onabort=function(){n._log("Reading file Abort!!"),e(new Error("Reading abort"))},r.readAsArrayBuffer(t)},c.prototype.readFromFileEntry=function(t,e){var i=this;t.file(function(t){i.readFromFileObject(t,e)})},c.prototype.readFile=function(t,e){var i=this;return t instanceof l||t instanceof Blob?this.readFromFileObject(t,e):void this.getFileEntry(t,function(t,n){return t?e(t):void i.readFromFileEntry(n,e)})},c.prototype.writeFile=function(t,e,i,n){var r=this;s.isBuffer(e)?(n=i,i=void 0):e=new s(e,i),this.getFileSystem(function(i){if(i)return n(i);var o={create:!0,exclusive:!0};r.getFileEntry(t,o,function(i,r){return i?n(new Error("Error getting file access "+i.message)):void r.createWriter(function(t){t.onwriteend=function(){n(null)},t.onerror=function(t){n(new Error(t.toString()))};var i=new Blob([e],{type:"application/octet-stream"});t.write(i)},function(){n(new Error("Error writing "+t))})})})},c.prototype.readFilePart=function(t,e,i,n){if("function"!=typeof t.slice)if("function"===t.mozSlice)t.slice=t.mozSlice;else{if("function"!==t.webkitSlice){var r=this._error("File has not slice method");return n(r)}t.slice=t.webkitSlice}return this.readFromFileObject(t.slice(e,i),n)},c.prototype.writeFilePart=function(t,e,i,n,r){var o=this;"number"!=typeof e&&(r=n,n=i,i=e,e=null),s.isBuffer(i)?(r=n,n=void 0):i=new s(i,n),this.getFileSystem(function(n){if(n)return r(n);var s={create:!1,exclusive:!0};o.getFileEntry(t,s,function(n,o){return n?r(new Error("Error getting file access "+n.message)):void o.createWriter(function(t){e||(e=t.length),t.onwriteend=function(){r(null)},t.onerror=function(t){r(new Error(t.toString()))};var n=new Blob([i],{type:"application/octet-stream"});t.seek(e),t.write(n)},function(){r(new Error("Error writing "+t))})})})},c.prototype.createReadStream=function(t,e){var i=new r(this,t,e);return i},c.prototype.createWriteStream=function(t,e){var i=new o(this,t,e);return i},c}),o("async",function(){return t}),o("buffer",function(){return e}),o("eventemitter2",function(){return i}),r("cofs/fs")});